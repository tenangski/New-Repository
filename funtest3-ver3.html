<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üêæfuntest3-ver3</title>
  <style>
    html, body {
      margin: 0; overflow: hidden; background: black;
      font-family: 'Orbitron', sans-serif;
    }
    canvas { display: block; }
    #hud {
      position: absolute; top: 10px; left: 10px;
      color: #0ff; z-index: 5; font-size: 1.2em;
      text-shadow: 0 0 10px #0ff;
    }
  </style>
</head>
<body>
  <div id="hud">üê± Cat Multiverse v2050</div>
  <canvas id="canvas2d"></canvas>
  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";

    /* --- 2D Background Animation --- */
    const canvas = document.getElementById('canvas2d');
    const ctx = canvas.getContext('2d');
    resize();
    window.addEventListener('resize', resize);
    function resize(){ canvas.width=innerWidth; canvas.height=innerHeight; }

    let time = 0;
    function drawBackground() {
      time += 0.02;
      ctx.fillStyle = `rgba(0,0,0,0.2)`;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      for(let i=0;i<50;i++){
        const x = (Math.sin(time+i)*2000+innerWidth/2)%(innerWidth);
        const y = (Math.cos(time+i*0.5)*1000+innerHeight/2)%(innerHeight);
        const color = `hsl(${(time*50+i*20)%360},100%,50%)`;
        ctx.beginPath();
        ctx.arc(x, y, 10+Math.sin(time+i)*5, 0, Math.PI*2);
        ctx.fillStyle = color;
        ctx.fill();
      }
    }

    /* --- 3D Scene Setup (Cat hologram) --- */
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({alpha:true});
    renderer.setSize(innerWidth, innerHeight);
    document.body.appendChild(renderer.domElement);
    camera.position.z = 5;

    const geometry = new THREE.TorusKnotGeometry(1, 0.3, 128, 64);
    const material = new THREE.ShaderMaterial({
      uniforms: { time: { value: 0 } },
      vertexShader: `varying vec2 vUv;
        void main(){ vUv = uv;
          gl_Position = projectionMatrix*modelViewMatrix*vec4(position,1.0);
        }`,
      fragmentShader: `uniform float time; varying vec2 vUv;
        void main(){
          float glow = sin(vUv.x*20.0+time*5.0)*0.5+0.5;
          gl_FragColor = vec4(glow, glow*0.2, 1.0, 1.0);
        }`
    });
    const catMesh = new THREE.Mesh(geometry, material);
    scene.add(catMesh);

    /* --- Audio Sync --- */
    const audio = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_4b73bda2cd.mp3?filename=funny-disco-loop-14192.mp3");
    const ctxAudio = new (window.AudioContext||window.webkitAudioContext)();
    const src = ctxAudio.createMediaElementSource(audio);
    const analyser = ctxAudio.createAnalyser();
    src.connect(analyser);
    analyser.connect(ctxAudio.destination);
    analyser.fftSize = 256;
    const data = new Uint8Array(analyser.frequencyBinCount);

    document.addEventListener("click", ()=>{
      audio.play(); ctxAudio.resume();
    });

    /* --- Main Loop --- */
    function animate(){
      requestAnimationFrame(animate);
      drawBackground();

      analyser.getByteFrequencyData(data);
      let bass = data.slice(0, 10).reduce((a,b)=>a+b,0)/10;
      let intensity = bass/255;

      catMesh.material.uniforms.time.value += 0.02 + intensity*0.05;
      catMesh.scale.set(1+intensity*0.5, 1+intensity*0.5, 1+intensity*0.5);
      catMesh.rotation.x += 0.01 + intensity*0.02;
      catMesh.rotation.y += 0.02 + intensity*0.02;

      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
